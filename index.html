<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linktree</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <img id="profile-picture" src="" alt="Profile Picture" class="profile-picture">
            <h1 id="profile-title"></h1>
            <div id="social-icons" class="social-icons"></div>
        </header>
        <main>
            <ul id="links-list" class="links-list"></ul>
        </main>
        <footer>
            <p>Powered by Vanilla JS</p>
        </footer>
    </div>

    <script>
        const profilePicEl = document.getElementById('profile-picture');
        const profileTitleEl = document.getElementById('profile-title');
        const socialIconsContainer = document.getElementById('social-icons');
        const linksList = document.getElementById('links-list');
        const container = document.querySelector('.container');

        // Embedded SVGs for self-contained icons
        const ICONS = {
            github: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.91 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>`,
            twitter: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616v.064c0 2.299 1.634 4.22 3.793 4.66-.426.115-.875.178-1.34.178-.288 0-.568-.027-.84-.079.588 1.834 2.273 3.226 4.312 3.262-1.68 1.332-3.83 2.115-6.177 2.115-.403 0-.8-.024-1.19-.069 2.175 1.433 4.823 2.253 7.693 2.253 9.218 0 14.26-7.824 13.999-14.646.962-.695 1.797-1.562 2.457-2.549z"/></svg>`,
            instagram: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.85s-.012 3.584-.07 4.85c-.148 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.069-4.85.069s-3.584-.012-4.85-.07c-3.252-.148-4.771-1.691-4.919-4.919-.058-1.265-.069-1.645-.069-4.85s.012-3.584.07-4.85c.148-3.225 1.664-4.771 4.919-4.919 1.266-.058 1.644-.069 4.85-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948s.014 3.667.072 4.947c.2 4.358 2.618 6.78 6.98 6.98 1.281.059 1.689.073 4.948.073s3.667-.014 4.947-.072c4.358-.2 6.78-2.618 6.98-6.98.059-1.281.073-1.689.073-4.948s-.014-3.667-.072-4.947c-.2-4.358-2.618-6.78-6.98-6.98-1.281-.059-1.689-.073-4.948-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.162 6.162 6.162 6.162-2.759 6.162-6.162-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4s1.791-4 4-4 4 1.79 4 4-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44 1.441-.645 1.441-1.44-.645-1.44-1.441-1.44z"/></svg>`,
            linkedin: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.968v16h4.969v-8.399c0-4.67 6.029-5.052 6.029 0v8.399h4.988v-10.131c0-7.88-8.922-7.593-11.018-3.714v-2.155z"/></svg>`,
            youtube: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/></svg>`,
        };

        /**
         * Renders the entire page based on the provided data object.
         * @param {object} data - The linktreeData object.
         */
        function renderPage(data) {
            const { theme, profile, socials, links } = data;
            
            // 1. Apply Theme
            document.body.className = theme || 'light-theme';

            // 2. Populate Profile
            if (profile) {
                profilePicEl.src = profile.pictureUrl || 'https://via.placeholder.com/96';
                profileTitleEl.textContent = profile.title || '@YourName';
                document.title = profile.title || 'Linktree';
            }

            // 3. Populate Social Icons
            socialIconsContainer.innerHTML = '';
            if (socials) {
                socials.forEach(social => {
                    if (!social.url || !ICONS[social.network]) return;
                    const a = document.createElement('a');
                    a.href = social.url;
                    a.target = '_blank';
                    a.title = social.network;
                    a.innerHTML = ICONS[social.network];
                    socialIconsContainer.appendChild(a);
                });
            }

            // 4. Populate Links
            linksList.innerHTML = '';
            if (links) {
                links.forEach(link => {
                    const li = document.createElement('li');
                    const a = document.createElement('a');
                    a.href = link.url;
                    a.target = "_blank";
                    a.dataset.linkId = link.id; // For click tracking

                    // Add thumbnail if available
                    if (link.thumbnailUrl) {
                        a.classList.add('has-thumbnail');
                        a.innerHTML = `
                            <img src="${link.thumbnailUrl}" alt="" class="link-thumbnail">
                            <span>${link.title}</span>`;
                    } else {
                        a.textContent = link.title;
                    }
                    
                    li.appendChild(a);
                    linksList.appendChild(li);
                });
            }
        }
        
        /**
         * Handles link clicks to track analytics.
         */
        function handleLinkClick(e) {
            const linkElement = e.target.closest('a[data-link-id]');
            if (!linkElement) return;

            const linkId = parseInt(linkElement.dataset.linkId, 10);
            const dataString = localStorage.getItem('linktreeData');
            if (!dataString) return;
            
            let data = JSON.parse(dataString);
            const link = data.links.find(l => l.id === linkId);
            
            if (link) {
                link.clicks = (link.clicks || 0) + 1;
                localStorage.setItem('linktreeData', JSON.stringify(data));
                // Note: The admin page won't see this update until it reloads/re-reads data.
                // This is a reasonable trade-off in a backend-less system.
            }
        }

        // --- INITIALIZATION ---

        // Listen for live updates from the admin panel
        window.addEventListener('message', (event) => {
            // A basic security check
            if (event.origin !== window.location.origin) return;
            if (event.data.type === 'update') {
                renderPage(event.data.payload);
            }
        });

        // Add a single click listener to the list for efficiency
        linksList.addEventListener('click', handleLinkClick);

        // Initial render on page load
        const initialData = localStorage.getItem('linktreeData');
        if (initialData) {
            renderPage(JSON.parse(initialData));
        } else {
            container.innerHTML = `
                <p class="default-message">This page has not been configured yet. 
                Visit <a href="/admin.html">the admin page</a> to set it up.</p>`;
        }
    </script>
</body>
</html>